# Netlify Configuration File (netlify.toml)
# https://docs.netlify.com/configure-builds/file-based-configuration/

# --- Build Settings ---
[build]
  # Directory containing Netlify Functions (serverless backend).
  functions = "functions/"
  
  # Directory containing the deploy-ready HTML, CSS, JS, and assets.
  # "." means the root directory of your project.
  publish = "."

  # Build command. Since this is a static site with no build tools (like React, Vue, etc.),
  # we leave this empty. Netlify will just deploy the files in the 'publish' directory.
  command = ""

# --- Redirects and Rewrites ---
# Redirects allow you to map URL paths.
# https://docs.netlify.com/routing/redirects/

# Rule to proxy API calls:
# Any request starting with "/api/" will be forwarded internally
# to the corresponding Netlify Function.
# Example: A request to "/api/register" executes the "functions/register.js" function.
[[redirects]]
  # The path the browser requests. "*" is a wildcard.
  from = "/api/*"
  # The internal path to the Netlify Function. ":splat" captures the wildcard part.
  to = "/.netlify/functions/:splat"
  # HTTP status code for the redirect (200 means it's an internal proxy, not a browser redirect).
  status = 200
  # Optionally force the redirect even if a file exists at the 'from' path
  # force = true # Usually not needed for /api/ paths


# --- Custom Headers ---
# Headers control browser caching, security policies, etc.
# https://docs.netlify.com/routing/headers/

# Cache settings for HTML pages (including index.html, verify.html)
[[headers]]
  for = "/*.html"
  [headers.values]
    # Cache in public caches (like CDNs) and browsers for 60 seconds.
    # must-revalidate: Check with the server if the cache is still valid after 60s.
    Cache-Control = "public, max-age=60, must-revalidate"

# Cache settings for the Service Worker (CRITICAL for PWA updates)
[[headers]]
  for = "/sw.js"
  [headers.values]
    # IMPORTANT: Never let HTTP cache the service worker long-term.
    # Browsers have their own update mechanism. 'no-cache' forces revalidation.
    Cache-Control = "no-cache" 
    # Also tell CDNs not to cache it (redundant but safe)
    Netlify-CDN-Cache-Control = "no-cache"

# Cache settings for the Web App Manifest
[[headers]]
  for = "/manifest.json"
  [headers.values]
    # Like the service worker, ensure this is checked frequently.
    Cache-Control = "public, max-age=0, must-revalidate"

# Cache settings for static assets (CSS, JS, images, etc.)
# This is a fallback for any assets not covered by more specific rules below.
[[headers]]
  for = "/assets/*"
  [headers.values]
    # Cache for a long time. 'immutable' tells the browser the file will not change.
    Cache-Control = "public, max-age=31536000, immutable"

# Specific, aggressive cache settings for CSS files.
[[headers]]
  for = "/assets/css/*"
  [headers.values]
    Cache-control = "public, max-age=31536000, immutable"

# Specific, aggressive cache settings for JS files.
[[headers]]
  for = "/assets/js/*"
  [headers.values]
    Cache-control = "public, max-age=31536000, immutable"