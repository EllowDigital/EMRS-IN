<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>EMRS E-Pass Portal</title>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"">
        <link rel=" stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
        <style>
            :root {
                font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
                color: #0f172a;
                background-color: #f3f4ff;
            }

            body {
                min-height: 100vh;
                background: radial-gradient(circle at top, #dbeafe 0%, rgba(255, 255, 255, 0) 60%),
                    linear-gradient(160deg, #eff6ff 0%, #f8f9ff 100%);
            }

            .app-hero {
                max-width: 820px;
            }

            .app-card {
                border: none;
                border-radius: 28px;
                box-shadow: 0 25px 60px rgba(15, 23, 42, 0.12);
                background: rgba(255, 255, 255, 0.92);
                backdrop-filter: blur(8px);
            }

            .app-card .card-header {
                border: none;
                background: transparent;
                padding-bottom: 0;
            }

            .app-card .card-body {
                padding: clamp(24px, 4vw, 40px);
            }

            .avatar-preview {
                width: 124px;
                height: 124px;
                border-radius: 50%;
                border: 3px solid rgba(59, 130, 246, 0.4);
                background: linear-gradient(135deg, rgba(96, 165, 250, 0.8), rgba(37, 99, 235, 0.65));
                display: grid;
                place-items: center;
                overflow: hidden;
                transition: border-color 0.3s ease, transform 0.2s ease;
            }

            .avatar-preview:hover {
                transform: translateY(-2px);
                border-color: rgba(37, 99, 235, 0.8);
            }

            .avatar-preview img {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            .upload-zone {
                border: 1px dashed rgba(37, 99, 235, 0.4);
                border-radius: 20px;
                padding: 18px 22px;
                background: rgba(59, 130, 246, 0.05);
            }

            .pass-preview img {
                border-radius: 24px;
                box-shadow: 0 28px 60px rgba(15, 23, 42, 0.18);
            }

            .fade-layer.fade {
                transition: opacity 0.25s ease, transform 0.25s ease;
            }

            .fade-layer.fade:not(.show) {
                opacity: 0;
                transform: translateY(12px);
            }

            .fade-layer.fade.show {
                opacity: 1;
                transform: translateY(0);
            }

            .icon-circle {
                width: 68px;
                height: 68px;
                border-radius: 50%;
                background: linear-gradient(135deg, #2563eb, #1d4ed8);
                color: #fff;
                display: grid;
                place-items: center;
                margin: 0 auto;
                box-shadow: 0 20px 40px rgba(37, 99, 235, 0.35);
            }

            .btn-soft-primary {
                background: rgba(37, 99, 235, 0.12);
                border: 1px solid rgba(37, 99, 235, 0.2);
                color: #1d4ed8;
            }

            .btn-soft-primary:hover {
                background: rgba(37, 99, 235, 0.2);
                color: #1d4ed8;
            }

            .floating-pill {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                padding: 0.6rem 1.2rem;
                border-radius: 999px;
                background: rgba(37, 99, 235, 0.08);
                color: #1d4ed8;
                font-weight: 600;
                font-size: 0.95rem;
            }

            .form-floating>.form-control:not(:placeholder-shown)~label,
            .form-floating>.form-control:focus~label {
                opacity: 0.85;
            }

            .search-layer {
                background: linear-gradient(180deg, rgba(15, 23, 42, 0.04) 0%, rgba(255, 255, 255, 0.94) 100%);
            }

            .pass-actions .btn {
                min-width: 180px;
            }

            footer {
                color: rgba(71, 85, 105, 0.8);
            }

            @media (max-width: 576px) {
                .app-card .card-body {
                    padding: 24px;
                }

                .pass-actions .btn {
                    width: 100%;
                    min-width: auto;
                }
            }
        </style>
    </head>

<body>
    <div class="container py-5 py-lg-5">
        <header class="text-center mx-auto app-hero mb-5">
            <div class="floating-pill shadow-sm mb-3">
                <span class="badge bg-primary rounded-pill">EMRS 2025</span>
                <span>Digital Access Pass Portal</span>
            </div>
            <h1 class="display-5 fw-bold mb-3">Generate, manage, and retrieve your EMRS e-pass in seconds</h1>
            <p class="lead text-secondary mb-0">Upload a quick selfie, add your contact details, and instantly get a
                QR-secured
                entry pass ready to download or share from any device.</p>
        </header>

        <div class="row g-4 g-xxl-5 align-items-start">
            <div class="col-lg-7">
                <div id="registerCard" class="card app-card fade-layer fade show" aria-labelledby="register-title">
                    <div class="card-body">
                        <div
                            class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3 mb-4">
                            <div>
                                <h2 id="register-title" class="fw-semibold mb-2">Create a new EMRS e-pass</h2>
                                <p class="text-secondary mb-0">We‚Äôll generate a secure QR pass you can download as PNG
                                    or share straight from your phone.</p>
                            </div>
                            <span class="badge text-bg-primary rounded-pill px-3 py-2">Average time: 15 seconds</span>
                        </div>

                        <div class="upload-zone mb-4">
                            <div class="d-flex flex-column flex-sm-row align-items-center gap-4">
                                <div class="text-center">
                                    <div class="avatar-preview mb-2" id="avatarPreview">
                                        <img id="avatarImage" alt="Profile preview" hidden>
                                        <span id="avatarPlaceholder" class="fw-semibold text-white">Add photo</span>
                                    </div>
                                    <small class="text-secondary">Square photos look best</small>
                                </div>
                                <div class="text-center text-sm-start">
                                    <label for="avatarInput" class="btn btn-soft-primary btn-lg">Upload profile
                                        image</label>
                                    <p class="text-secondary small mb-0">JPEG or PNG ‚Ä¢ Max 5 MB ‚Ä¢ We‚Äôll compress it
                                        automatically</p>
                                </div>
                            </div>
                            <input id="avatarInput" type="file" accept="image/*" hidden>
                        </div>

                        <form id="registrationForm" class="row g-3 needs-validation" novalidate>
                            <div class="col-12">
                                <label for="fullName" class="form-label fw-semibold">Full name</label>
                                <input id="fullName" name="fullName" type="text" class="form-control form-control-lg"
                                    placeholder="Jane Doe" required autocomplete="name">
                            </div>
                            <div class="col-md-6">
                                <label for="phone" class="form-label fw-semibold">Phone number</label>
                                <div class="input-group input-group-lg">
                                    <span class="input-group-text">+91</span>
                                    <input id="phone" name="phone" type="tel" class="form-control"
                                        placeholder="9876543210" required pattern="\d{10}" inputmode="numeric"
                                        maxlength="10" autocomplete="tel-national">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <label for="email" class="form-label fw-semibold">Email address</label>
                                <input id="email" name="email" type="email" class="form-control form-control-lg"
                                    placeholder="jane@email.com" required autocomplete="email">
                            </div>
                            <div class="col-md-6">
                                <label for="city" class="form-label fw-semibold">City</label>
                                <input id="city" name="city" type="text" class="form-control form-control-lg"
                                    placeholder="Lucknow" required autocomplete="address-level2">
                            </div>
                            <div class="col-md-6">
                                <label for="state" class="form-label fw-semibold">State</label>
                                <select id="state" name="state" class="form-select form-select-lg" required
                                    autocomplete="address-level1">
                                    <option value="" disabled selected>Select state</option>
                                    <option value="UP">Uttar Pradesh</option>
                                    <option value="DL">Delhi</option>
                                    <option value="MH">Maharashtra</option>
                                    <option value="RJ">Rajasthan</option>
                                    <option value="KA">Karnataka</option>
                                    <option value="TN">Tamil Nadu</option>
                                    <option value="WB">West Bengal</option>
                                    <option value="KL">Kerala</option>
                                    <option value="GJ">Gujarat</option>
                                    <option value="PB">Punjab</option>
                                </select>
                            </div>
                            <div class="col-12">
                                <button type="submit" class="btn btn-primary btn-lg w-100">Generate E-Pass</button>
                            </div>
                        </form>
                        <div id="registrationFeedback" class="alert d-none fade mt-4" role="status" aria-live="polite">
                        </div>
                    </div>
                </div>

                <div id="registerSuccess" class="card app-card fade-layer fade d-none mt-4 mt-lg-5" aria-live="polite">
                    <div class="card-body text-center">
                        <div class="icon-circle mb-3">
                            <span class="fs-3">‚úì</span>
                        </div>
                        <h2 class="fw-bold mb-2">Your e-pass is ready!</h2>
                        <p class="text-secondary mb-4" id="registerSuccessMessage">Download the PNG pass or generate
                            another one immediately.</p>
                        <div class="pass-preview mx-auto mb-4">
                            <img id="epassImage" class="img-fluid" alt="Generated EMRS e-pass">
                        </div>
                        <div class="mb-4">
                            <h5 class="fw-semibold mb-1" id="epassName"></h5>
                            <span class="text-secondary" id="epassReg"></span>
                        </div>
                        <div class="pass-actions d-flex flex-column flex-sm-row gap-3 justify-content-center">
                            <a id="epassDownload"
                                class="btn btn-primary btn-lg px-4 d-flex align-items-center justify-content-center gap-2"
                                download="emrs-epass.png">
                                <i class="bi bi-download"></i>
                                <span>Download E-Pass</span>
                            </a>
                            <button type="button" id="registerAgainBtn"
                                class="btn btn-outline-primary btn-lg px-4 d-flex align-items-center justify-content-center gap-2">
                                <i class="bi bi-person-plus"></i>
                                <span>Register New Pass</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-5">
                <div id="searchCard" class="card app-card search-layer fade-layer fade show"
                    aria-labelledby="find-title">
                    <div class="card-body">
                        <h3 id="find-title" class="fw-semibold mb-2">Find an existing e-pass</h3>
                        <p class="text-secondary mb-4">Enter the phone number or email used during registration. We‚Äôll
                            pull your
                            most recent pass instantly.</p>
                        <form id="searchForm" class="needs-validation" novalidate>
                            <div class="mb-3">
                                <label for="searchPhone" class="form-label fw-semibold">Phone number</label>
                                <input id="searchPhone" name="searchPhone" type="tel"
                                    class="form-control form-control-lg" placeholder="9876543210" pattern="\d{10}"
                                    maxlength="10" inputmode="numeric">
                            </div>
                            <div class="mb-3">
                                <label for="searchEmail" class="form-label fw-semibold">Email address</label>
                                <input id="searchEmail" name="searchEmail" type="email"
                                    class="form-control form-control-lg" placeholder="name@email.com">
                            </div>
                            <button type="submit" class="btn btn-outline-primary btn-lg w-100">Search E-Pass</button>
                        </form>
                        <div id="searchFeedback" class="alert d-none fade mt-4" role="status" aria-live="polite"></div>
                    </div>
                </div>

                <div id="searchResultCard" class="card app-card fade-layer fade d-none mt-4" aria-live="polite">
                    <div class="card-body text-center">
                        <div class="icon-circle mb-3">
                            <span class="fs-4">üîç</span>
                        </div>
                        <h3 class="fw-bold mb-2">We found your pass</h3>
                        <p class="text-secondary mb-4" id="searchMessage">Show this pass at entry or download it as a
                            PNG.</p>
                        <div class="pass-preview mx-auto mb-4">
                            <img id="searchImage" class="img-fluid" alt="Retrieved EMRS e-pass">
                        </div>
                        <div class="mb-3">
                            <h5 class="fw-semibold mb-1" id="searchName"></h5>
                            <span class="text-secondary" id="searchReg"></span>
                        </div>
                        <div class="pass-actions d-flex flex-column flex-sm-row gap-3 justify-content-center">
                            <a id="searchDownload"
                                class="btn btn-primary btn-lg px-4 d-flex align-items-center justify-content-center gap-2"
                                download="emrs-epass.png">
                                <i class="bi bi-download"></i>
                                <span>Download E-Pass</span>
                            </a>
                            <button type="button" id="searchAgainBtn"
                                class="btn btn-outline-primary btn-lg px-4 d-flex align-items-center justify-content-center gap-2">
                                <i class="bi bi-search"></i>
                                <span>Search again</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <footer class="text-center mt-5 pt-lg-3 small">EMRS (Event Management & Registration System) by EllowDigital
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-q2nyq7rlaRykWGBqBPdZiZsa1+lZeFePmSu2VvulaHYodEc/WWEDuJeCQM2ngiZX" crossorigin="anonymous"
        defer></script>
    <script>
        const avatarInput = document.getElementById('avatarInput');
        const avatarImage = document.getElementById('avatarImage');
        const avatarPlaceholder = document.getElementById('avatarPlaceholder');
        const avatarPreview = document.getElementById('avatarPreview');

        const registrationForm = document.getElementById('registrationForm');
        const registrationFeedback = document.getElementById('registrationFeedback');
        const stateSelect = document.getElementById('state');
        const submitButton = registrationForm.querySelector('button[type="submit"]');

        const registerCard = document.getElementById('registerCard');
        const registerSuccess = document.getElementById('registerSuccess');
        const registerAgainBtn = document.getElementById('registerAgainBtn');
        const registerSuccessMessage = document.getElementById('registerSuccessMessage');

        const epassImage = document.getElementById('epassImage');
        const epassName = document.getElementById('epassName');
        const epassReg = document.getElementById('epassReg');
        const epassDownload = document.getElementById('epassDownload');

        const searchForm = document.getElementById('searchForm');
        const searchFeedback = document.getElementById('searchFeedback');
        const searchPhoneInput = document.getElementById('searchPhone');
        const searchEmailInput = document.getElementById('searchEmail');
        const searchCard = document.getElementById('searchCard');
        const searchResultCard = document.getElementById('searchResultCard');
        const searchAgainBtn = document.getElementById('searchAgainBtn');
        const searchMessage = document.getElementById('searchMessage');
        const searchImage = document.getElementById('searchImage');
        const searchName = document.getElementById('searchName');
        const searchReg = document.getElementById('searchReg');
        const searchDownload = document.getElementById('searchDownload');

        const defaultBorderColor = 'rgba(59, 130, 246, 0.4)';

        const showLayer = (element) => {
            element.classList.remove('d-none');
            requestAnimationFrame(() => {
                element.classList.add('show');
            });
        };

        const hideLayer = (element) => {
            element.classList.remove('show');
            const handleTransitionEnd = () => {
                element.classList.add('d-none');
                element.removeEventListener('transitionend', handleTransitionEnd);
            };
            element.addEventListener('transitionend', handleTransitionEnd);
            setTimeout(() => {
                if (!element.classList.contains('show')) {
                    element.classList.add('d-none');
                }
            }, 260);
        };

        const resetAvatar = () => {
            avatarImage.src = '';
            avatarImage.hidden = true;
            avatarPlaceholder.hidden = false;
            avatarPreview.style.borderColor = defaultBorderColor;
            avatarInput.value = '';
        };

        avatarInput.addEventListener('change', (event) => {
            const file = event.target.files?.[0];
            if (!file) {
                resetAvatar();
                return;
            }

            if (!file.type.startsWith('image/')) {
                alert('Please choose a valid image file.');
                avatarInput.value = '';
                return;
            }

            const reader = new FileReader();
            reader.onload = (loadEvent) => {
                avatarImage.src = loadEvent.target?.result || '';
                avatarImage.hidden = false;
                avatarPlaceholder.hidden = true;
                avatarPreview.style.borderColor = 'rgba(37, 99, 235, 0.8)';
            };
            reader.readAsDataURL(file);
        });

        const phoneInput = document.getElementById('phone');
        phoneInput.addEventListener('input', () => {
            phoneInput.value = phoneInput.value.replace(/\D/g, '').slice(0, 10);
        });

        searchPhoneInput.addEventListener('input', () => {
            searchPhoneInput.value = searchPhoneInput.value.replace(/\D/g, '').slice(0, 10);
        });

        const toggleAlert = (element, message, state) => {
            element.textContent = message || '';
            element.classList.add('alert');
            element.classList.remove('alert-success', 'alert-danger', 'alert-info', 'show');

            if (!message) {
                element.classList.add('d-none');
                return;
            }

            const variant = state === 'success' ? 'alert-success' : state === 'error' ? 'alert-danger' : 'alert-info';
            element.classList.add(variant);
            element.classList.remove('d-none');
            requestAnimationFrame(() => element.classList.add('show'));
        };

        const calculateDataUrlBytes = (dataUrl) => {
            const base64 = dataUrl.split(',')[1] || '';
            return Math.ceil((base64.length * 3) / 4);
        };

        const loadImageElement = (file) => new Promise((resolve, reject) => {
            const url = URL.createObjectURL(file);
            const image = new Image();
            image.onload = () => {
                URL.revokeObjectURL(url);
                resolve(image);
            };
            image.onerror = () => {
                URL.revokeObjectURL(url);
                reject(new Error('Unable to load image.'));
            };
            image.src = url;
        });

        const compressImage = async (file) => {
            const image = await loadImageElement(file);
            const canvas = document.createElement('canvas');
            const targetBytes = 20000;
            let quality = 0.7;
            let width = image.width;
            let height = image.height;
            const maxDimension = 700;

            if (width > height && width > maxDimension) {
                height = Math.round((height / width) * maxDimension);
                width = maxDimension;
            } else if (height > maxDimension) {
                width = Math.round((width / height) * maxDimension);
                height = maxDimension;
            }

            const drawToCanvas = (targetWidth, targetHeight) => {
                canvas.width = targetWidth;
                canvas.height = targetHeight;
                const ctx = canvas.getContext('2d', { alpha: false });
                if (!ctx) {
                    throw new Error('Image compression is not supported in this browser.');
                }
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';
                ctx.drawImage(image, 0, 0, targetWidth, targetHeight);
            };

            drawToCanvas(width, height);
            let dataUrl = canvas.toDataURL('image/jpeg', quality);

            while (calculateDataUrlBytes(dataUrl) > targetBytes && quality > 0.3) {
                quality = Math.max(0.3, quality - 0.1);
                dataUrl = canvas.toDataURL('image/jpeg', quality);
            }

            while (calculateDataUrlBytes(dataUrl) > targetBytes && width > 150 && height > 150) {
                width = Math.round(width * 0.85);
                height = Math.round(height * 0.85);
                drawToCanvas(width, height);
                dataUrl = canvas.toDataURL('image/jpeg', quality);
            }

            return dataUrl;
        };

        const convertSvgToPng = (svgDataUrl) => new Promise((resolve, reject) => {
            const image = new Image();
            image.crossOrigin = 'anonymous';
            image.onload = () => {
                const canvas = document.createElement('canvas');
                const width = image.naturalWidth || 720;
                const height = image.naturalHeight || 420;
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');
                if (!ctx) {
                    reject(new Error('Canvas is not supported in this browser.'));
                    return;
                }
                ctx.drawImage(image, 0, 0, width, height);
                resolve(canvas.toDataURL('image/png'));
            };
            image.onerror = () => reject(new Error('Unable to convert pass to PNG.'));
            image.src = svgDataUrl;
        });

        const prepareDownloadLink = async (anchor, svgDataUrl, filename) => {
            if (!svgDataUrl) {
                anchor.removeAttribute('href');
                return;
            }
            try {
                const pngDataUrl = await convertSvgToPng(svgDataUrl);
                anchor.href = pngDataUrl;
                anchor.download = `${filename}.png`;
            } catch (error) {
                console.warn(error.message);
                anchor.href = svgDataUrl;
                anchor.download = `${filename}.svg`;
            }
        };

        registrationForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            avatarPreview.style.borderColor = defaultBorderColor;

            const profileFile = avatarInput.files?.[0];
            if (!profileFile) {
                toggleAlert(registrationFeedback, 'Please upload an image.', 'error');
                avatarPreview.style.borderColor = 'rgba(220, 38, 38, 0.6)';
                return;
            }

            const formData = new FormData(registrationForm);
            const payload = {
                fullName: formData.get('fullName'),
                phone: formData.get('phone'),
                email: formData.get('email'),
                city: formData.get('city'),
                state: formData.get('state'),
            };

            submitButton.disabled = true;

            try {
                toggleAlert(registrationFeedback, 'Compressing your photo‚Ä¶', 'info');
                const compressedImage = await compressImage(profileFile);
                if (!compressedImage) {
                    throw new Error('Unable to process the selected image. Please try another file.');
                }
                payload.profileImage = compressedImage;

                toggleAlert(registrationFeedback, 'Generating your e-pass‚Ä¶', 'info');
                const response = await fetch('/.netlify/functions/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });

                const data = await response.json();

                if (response.status === 409) {
                    throw new Error(data.message || 'This phone number already has an e-pass. Try the Find Pass tool.');
                }

                if (!response.ok || !data.success) {
                    throw new Error(data.message || 'Registration failed. Please try again.');
                }

                const passDataUrl = data.epass?.dataUrl;
                epassName.textContent = data.attendee?.fullName || '';
                epassReg.textContent = data.attendee?.registrationId ? `Registration ID: ${data.attendee.registrationId}` : '';
                epassImage.src = passDataUrl || '';

                toggleAlert(registrationFeedback, 'üéâ Pass generated successfully! Preparing your download‚Ä¶', 'success');
                await prepareDownloadLink(epassDownload, passDataUrl, 'emrs-epass');

                hideLayer(registerCard);
                registerSuccessMessage.textContent = 'Download your PNG pass or register another attendee immediately.';
                showLayer(registerSuccess);

                registrationForm.reset();
                stateSelect.selectedIndex = 0;
                resetAvatar();
            } catch (error) {
                console.error(error);
                toggleAlert(registrationFeedback, error.message, 'error');
                avatarPreview.style.borderColor = error.message.toLowerCase().includes('image')
                    ? 'rgba(220, 38, 38, 0.6)'
                    : defaultBorderColor;
            } finally {
                submitButton.disabled = false;
            }
        });

        registerAgainBtn.addEventListener('click', () => {
            toggleAlert(registrationFeedback, '', '');
            showLayer(registerCard);
            hideLayer(registerSuccess);
        });

        searchForm.addEventListener('submit', async (event) => {
            event.preventDefault();

            const phone = searchPhoneInput.value.replace(/\D/g, '').slice(0, 10);
            const email = searchEmailInput.value.trim();

            if (!phone && !email) {
                toggleAlert(searchFeedback, 'Enter your 10-digit phone number or email to continue.', 'error');
                return;
            }

            toggleAlert(searchFeedback, 'Searching for your pass‚Ä¶', 'info');

            const payload = {};
            if (phone) payload.phone = phone;
            if (email) payload.email = email;

            try {
                const response = await fetch('/.netlify/functions/find-pass', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload),
                });

                const data = await response.json();

                if (!response.ok || !data.success) {
                    throw new Error(data.message || 'We could not locate your e-pass.');
                }

                const passDataUrl = data.epass?.dataUrl;
                searchName.textContent = data.attendee?.fullName || '';
                searchReg.textContent = data.attendee?.registrationId
                    ? `Registration ID: ${data.attendee.registrationId}`
                    : '';
                searchImage.src = passDataUrl || '';

                toggleAlert(searchFeedback, 'Pass located! Preparing your PNG download‚Ä¶', 'success');
                await prepareDownloadLink(searchDownload, passDataUrl, 'emrs-epass');

                hideLayer(searchCard);
                showLayer(searchResultCard);
            } catch (error) {
                console.error(error);
                toggleAlert(searchFeedback, error.message, 'error');
            }
        });

        searchAgainBtn.addEventListener('click', () => {
            toggleAlert(searchFeedback, '', '');
            searchForm.reset();
            showLayer(searchCard);
            hideLayer(searchResultCard);
            searchPhoneInput.focus();
        });
    </script>
</body>

</html>